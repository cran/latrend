<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Niek Den Teuling" />

<meta name="date" content="2021-01-16" />

<title>Implementing new methods</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Implementing new methods</h1>
<h4 class="author">Niek Den Teuling</h4>
<h4 class="date">2021-01-16</h4>


<div id="TOC">
<ul>
<li><a href="#case-study-data" id="toc-case-study-data">Case study
data</a></li>
<li><a href="#stratification" id="toc-stratification">Stratification</a></li>
<li><a href="#two-step-clustering" id="toc-two-step-clustering">Two-step
clustering</a>
<ul>
<li><a href="#general-approach" id="toc-general-approach">General
approach</a></li>
</ul></li>
</ul>
</div>

<p>In this vignette we demonstrate how to define new methods.</p>
<div id="case-study-data" class="section level1">
<h1>Case study data</h1>
<p>We will generate a dataset comprising two clusters with a different
intercept and slope. Firstly, we configure the default id, time, and
response variable, so that these do not need to be provided to the other
function calls.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latrend)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">latrend.id =</span> <span class="st">&quot;Traj&quot;</span>, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">latrend.time =</span> <span class="st">&quot;Time&quot;</span>,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">latrend.verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Next, we generate the dataset, with 40 trajectories for cluster A and
60 trajectories for cluster B. Cluster A involves trajectories with a
downward slope, whereas cluster B has an upward slope. We define a fixed
mean of 1, such that all the cluster trajectories are shifted, placing
cluster A at intercept 2, and cluster B at intercept 1.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>casedata <span class="ot">&lt;-</span> <span class="fu">generateLongData</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">60</span>), </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> Y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixedCoefs =</span> <span class="dv">1</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster =</span> <span class="sc">~</span> Time, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusterCoefs =</span> <span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="sc">-</span>.<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">05</span>)),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="sc">~</span> Time,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">randomScales =</span> <span class="fu">cbind</span>(<span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">02</span>), <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">02</span>)),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">noiseScales =</span> .<span class="dv">05</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.table</span>()</span></code></pre></div>
<p>We plot the data to get a sense of different trajectories that have
been generated. Visually, there is little group separation.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotTrajectories</span>(casedata, <span class="at">response =</span> <span class="st">&quot;Y&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Since we generated the data, we have the luxury of looking at
reference cluster trajectories, as stored in the <code>Mu.cluster</code>
column. Note that <code>Mu.fixed</code> must be added to obtain the
correct values.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotClusterTrajectories</span>(casedata, <span class="at">response =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">cluster =</span> <span class="st">&quot;Class&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="stratification" class="section level1">
<h1>Stratification</h1>
<p>Rather than starting with clustering, in some case studies there may
be prior knowledge on how to sensibly stratify the trajectories. Either
by an observed independent variable (e.g., age or gender), or a certain
aspect of the observed trajectory (e.g., the intercept, slope,
variability).</p>
<p>Let’s presume in this example that domain knowledge suggests that
stratifying by the intercept may provide a sensible grouping of the
trajectories. This approach is further supported by the density plot of
the trajectory intercepts, which shows a bimodal distribution.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(casedata[Time <span class="sc">==</span> <span class="dv">0</span>], <span class="fu">aes</span>(<span class="at">x =</span> Mu)) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">fill =</span> <span class="st">&quot;gray&quot;</span>, <span class="at">adjust =</span> .<span class="dv">3</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>Based on the density plot, we will assign trajectories with an
intercept above 1.6 to cluster A, and the remainder to cluster B.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>method <span class="ot">&lt;-</span> <span class="fu">lcMethodStratify</span>(<span class="at">response =</span> <span class="st">&quot;Y&quot;</span>, Y[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="fl">1.6</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">latrend</span>(method, casedata)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">clusterProportions</span>(model)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   A   B </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.6 0.4</span></span></code></pre></div>
<p>The approach we specified requires the first observation to be
available, and is sensitive to noise. A more robust alternative would be
to fit a linear model per trajectory, and to use the estimated intercept
to stratify the trajectories on.</p>
<p>We can specify this stratification model by defining a function which
takes the data of separate trajectories as input. This function should
return a single cluster assignment for the respective trajectory. By
returning a factor, we can pre-specify the cluster names.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>stratfun <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  int <span class="ot">&lt;-</span> <span class="fu">coef</span>(<span class="fu">lm</span>(Y <span class="sc">~</span> Time, data))[<span class="dv">1</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(int <span class="sc">&gt;</span> <span class="fl">1.7</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;High&quot;</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lcMethodStratify</span>(<span class="at">response =</span> <span class="st">&quot;Y&quot;</span>, <span class="at">stratify =</span> stratfun, <span class="at">center =</span> mean)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">latrend</span>(m2, casedata)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">clusterProportions</span>(model2)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Low High </span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0.6  0.4</span></span></code></pre></div>
<p>In case the linear regression step is time-intensive, a more
efficient approach is to save the pre-computed trajectory intercepts as
a column in the original data. This column can then be referred to in
the expression of the stratification model.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>casedata[, Intercept <span class="sc">:</span><span class="er">=</span> <span class="fu">coef</span>(<span class="fu">lm</span>(Y <span class="sc">~</span> Time, .SD))[<span class="dv">1</span>], by <span class="ot">=</span> Traj]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lcMethodStratify</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">response =</span> <span class="st">&quot;Y&quot;</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">stratify =</span> Intercept[<span class="dv">1</span>] <span class="sc">&gt;</span> <span class="fl">1.7</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusterNames =</span> <span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;High&quot;</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">latrend</span>(m3, casedata)</span></code></pre></div>
</div>
<div id="two-step-clustering" class="section level1">
<h1>Two-step clustering</h1>
<p>We can take the approach involving the estimation of a linear model
per trajectory one step further. Instead of using a pre-defined
threshold on the intercept, we use a cluster algorithm on both the
intercept and slope to automatically find clusters.</p>
<p>We first define the representation step, which estimates the model
coefficients per trajectory, and outputs a <code>matrix</code> with the
coefficients per trajectory per row.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>repStep <span class="ot">&lt;-</span> <span class="cf">function</span>(method, data, verbose) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(data)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  coefdata <span class="ot">&lt;-</span> dt[, <span class="fu">lm</span>(Y <span class="sc">~</span> Time, .SD) <span class="sc">%&gt;%</span> <span class="fu">coef</span>() <span class="sc">%&gt;%</span> <span class="fu">as.list</span>(), keyby <span class="ot">=</span> Traj]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  coefmat <span class="ot">&lt;-</span> <span class="fu">subset</span>(coefdata, <span class="at">select =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(coefmat) <span class="ot">&lt;-</span> coefdata<span class="sc">$</span>Traj</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  coefmat</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The cluster step takes the coefficient matrix as input. A
cross-sectional cluster algorithm can then be applied to the matrix. In
this example, we apply <span class="math inline">\(k\)</span>-means. The
cluster step should output a <code>lcModel</code> object.</p>
<p>The <code>lcModelPartition</code> function creates a
<code>lcModel</code> object for a given vector of cluster
assignments.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>clusStep <span class="ot">&lt;-</span> <span class="cf">function</span>(method, data, repMat, envir, verbose) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(repMat, <span class="at">centers =</span> <span class="dv">3</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lcModelPartition</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">response =</span> method<span class="sc">$</span>response, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">trajectoryAssignments =</span> km<span class="sc">$</span>cluster,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">center =</span> method<span class="sc">$</span>center,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> method,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> km</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We are now ready to create the <code>lcMethodFeature</code>
method.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>m.twostep <span class="ot">&lt;-</span> <span class="fu">lcMethodFeature</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">response =</span> <span class="st">&quot;Y&quot;</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">representationStep =</span> repStep, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusterStep =</span> clusStep</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>model.twostep <span class="ot">&lt;-</span> <span class="fu">latrend</span>(m.twostep, <span class="at">data =</span> casedata)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.twostep)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Longitudinal cluster model using part</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lcMethodFeature specifying &quot;two-step clustering&quot;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  standardize:    `scale`</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  center:         `meanNA`</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  time:           &quot;Time&quot;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  id:             &quot;Traj&quot;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  response:       &quot;Y&quot;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  representationStep:`repStep`</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  clusterStep:    `clusStep`</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Cluster sizes (K=3):</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        A        B        C </span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 35 (35%) 25 (25%) 40 (40%) </span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of obs: 1100, strata (Traj): 100</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Scaled residuals:</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -3.08943 -0.67260  0.03618  0.00000  0.73723  2.64516</span></span></code></pre></div>
<div id="general-approach" class="section level2">
<h2>General approach</h2>
<p>The two-step model defined above is hard-coded for a given formula
and a fixed number of clusters. In an exploratory setting, it is
convenient to define a parameterized method. Here, we change the two
functions to take arguments through the <code>lcMethod</code> object in
the <code>method</code> variable.</p>
<p>Note that we can introduce new arguments which are not originally
part of <code>lcMethodFeature</code> (e.g., <code>nClusters</code>) to
enable the specification of the number of clusters in our method.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>repStep.gen <span class="ot">&lt;-</span> <span class="cf">function</span>(method, data, verbose) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  dt <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(data)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  coefdata <span class="ot">&lt;-</span> dt[, <span class="fu">lm</span>(method<span class="sc">$</span>formula, .SD) <span class="sc">%&gt;%</span> <span class="fu">coef</span>() <span class="sc">%&gt;%</span> <span class="fu">as.list</span>(), keyby <span class="ot">=</span> <span class="fu">c</span>(method<span class="sc">$</span>id)]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exclude the id column</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  coefmat <span class="ot">&lt;-</span> <span class="fu">subset</span>(coefdata, <span class="at">select =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(coefmat) <span class="ot">&lt;-</span> coefdata[[method<span class="sc">$</span>id]]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  coefmat</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>clusStep.gen <span class="ot">&lt;-</span> <span class="cf">function</span>(method, data, repMat, envir, verbose) {</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(repMat, <span class="at">centers =</span> method<span class="sc">$</span>nClusters)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lcModelPartition</span>(</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">response =</span> method<span class="sc">$</span>response,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data, </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">trajectoryAssignments =</span> km<span class="sc">$</span>cluster,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">center =</span> method<span class="sc">$</span>center,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> method,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> km</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We create a new <code>lcMethodFeature</code> instance with the more
generic functions. Defining values for <code>formula</code> and
<code>nClusters</code> here makes these arguments values act as default
values in a call of <code>latrend</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>m.twostepgen <span class="ot">&lt;-</span> <span class="fu">lcMethodFeature</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">response =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">representationStep =</span> repStep.gen, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">clusterStep =</span> clusStep.gen</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>However, because we omitted the specification of <code>formula</code>
and <code>nClusters</code>, these need to be provided in the
<code>latrend</code> call.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>model.twostepgen <span class="ot">&lt;-</span> <span class="fu">latrend</span>(m.twostepgen, <span class="at">formula =</span> Y <span class="sc">~</span> Time, <span class="at">nClusters =</span> <span class="dv">2</span>, casedata)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.twostepgen)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Longitudinal cluster model using part</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; lcMethodFeature specifying &quot;two-step clustering&quot;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  nClusters:      2</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  formula:        Y ~ Time</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  standardize:    `scale`</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  center:         `meanNA`</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  time:           &quot;Time&quot;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  id:             &quot;Traj&quot;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  response:       &quot;Y&quot;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  representationStep:`repStep.gen`</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  clusterStep:    `clusStep.gen`</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Cluster sizes (K=2):</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        A        B </span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 40 (40%) 60 (60%) </span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of obs: 1100, strata (Traj): 100</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Scaled residuals:</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -2.9747 -0.6992  0.0589  0.0000  0.6958  2.9260</span></span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
